# EntityStatementGenerator

This Java application generates JWTs for either a client assertion or a signed OpenID Federation entity statement, using an EC private key in PEM format. It uses the `nimbus-jose-jwt` library for JWT creation and signing, with Bouncy Castle as the cryptographic provider.

## Prerequisites

- **Java**: JDK 17 or higher.
- **Maven**: For building and running the project.
- **EC Private Key**: A valid EC private key in PEM format (e.g., `/etc/keys/es512-private.pem` ).

## Execution Instructions

### Using Maven
To compile and run the application with Maven, use the following command:

```bash
mvn compile exec:java -Dexec.args="<mode> <path_to_private_key>"
```

- `<mode>`: Either `assertion` (for client assertion JWT) or `entity` (for signed entity statement JWT).
- `<path_to_private_key>`: The full path to the EC private key PEM file.

**Example**:
```bash
mvn compile exec:java -Dexec.args="assertion C:/old_E/ec_private.pem"
```

This will generate a client assertion JWT using the specified private key.

### Using JAR
1. Build the JAR file:
   ```bash
   mvn clean package
   ```
   This creates a JAR file in the `target/` directory (e.g., `target/EntityStatementGenerator-1.0-SNAPSHOT.jar`).

2. Run the JAR:
   ```bash
   java -jar target/EntityStatementGenerator-1.0-SNAPSHOT.jar <mode> <path_to_private_key>
   ```

**Example**:
```bash
java -jar target/EntityStatementGenerator-1.0-SNAPSHOT.jar assertion ./ec_private.pem
```

If no arguments are provided, the program will prompt for:
- Mode (`assertion` or `entity`, default: `assertion`).
- Path to the EC private key PEM file (default: `/etc/keys/es512-private.pem`).
- For `assertion` mode, optional overrides for:
    - `CLIENT_ID` (default: `https://offa.hadem.vm.grnet.gr`).
    - `AUDIENCE` (default: `https://rciam.example.org/auth/realms/rciam`).
    - `JWS Algorithm` (default: `ES512`).

## Using the Generated Client Assertion

The client assertion JWT generated in `assertion` mode can be used in the following `curl` command to introspect a token via an OpenID Connect token introspection endpoint:

```bash
curl {token_introspection_endpoint} \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "token={token}" \
  -d "client_id={client_id}" \
  -d "client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer" \
  -d "client_assertion={client_assertion}"
```

Replace the placeholders:
- `{token_introspection_endpoint}`: The Token Introspection Endpoint of the OpenID Provider (e.g., `https://rciam.example.org/auth/realms/rciam/protocol/openid-connect/token/introspect`).
- `{token}`: The token to introspect.
- `{client_id}`: The client ID (e.g., `https://offa.hadem.vm.grnet.gr`).
- `{client_assertion}`: The JWT generated by the application in `assertion` mode.

**Example**:
```bash
curl https://rciam.example.org/auth/realms/rciam/protocol/openid-connect/token/introspect \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d "client_id=https://offa.hadem.vm.grnet.gr" \
  -d "client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer" \
  -d "client_assertion=eyJhbGciOiJFUzUxMiIsInR5cCI6IkpXVCJ9..."
```

## Notes
- Ensure the EC private key file is in a valid PEM format (e.g., `-----BEGIN EC PRIVATE KEY-----`).
- For the `entity` mode, the generated JWT includes a JWKSet and metadata for OpenID Federation.
